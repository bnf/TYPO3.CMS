/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define(["require","exports","cm/lib/codemirror","lit-element","TYPO3/CMS/Backend/FormEngine","TYPO3/CMS/Core/DocumentService"],(function(e,t,r,o,n,i){"use strict";r=__importDefault(r);let s=class extends o.LitElement{constructor(){super(...arguments),this.addons=[],this.options={}}render(){return o.html`<slot></slot>`}firstUpdated(){const e={root:document.body};let t=new IntersectionObserver(e=>{e.forEach(e=>{e.intersectionRatio>0&&(t.unobserve(e.target),this.initializeEditor(e.target))})},e);const r=this.querySelector("textarea");r&&t.observe(r)}createPanelNode(e,t){const r=document.createElement("div");r.setAttribute("class","CodeMirror-panel CodeMirror-panel-"+e),r.setAttribute("id","panel-"+e);const o=document.createElement("span");return o.textContent=t,r.appendChild(o),r}initializeEditor(t){const o=this.mode.split("/"),i=this.options;e([this.mode,...this.addons],()=>{const e=r.default.fromTextArea(t,{extraKeys:{"Ctrl-F":"findPersistent","Cmd-F":"findPersistent","Ctrl-Alt-F":e=>{e.setOption("fullScreen",!e.getOption("fullScreen"))},"Ctrl-Space":"autocomplete",Esc:e=>{e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}},fullScreen:!1,lineNumbers:!0,lineWrapping:!0,mode:o[o.length-1]});Object.keys(i).map(t=>{e.setOption(t,i[t])}),e.on("change",()=>{n.Validation.markFieldAsChanged(t)});const s=this.createPanelNode("bottom",t.getAttribute("alt"));if(e.addPanel(s,{position:"bottom",stable:!1}),t.getAttribute("rows")){const r=18,o=4;e.setSize(null,parseInt(t.getAttribute("rows"),10)*r+o+s.getBoundingClientRect().height)}else e.getWrapperElement().style.height=document.body.getBoundingClientRect().height-e.getWrapperElement().getBoundingClientRect().top-80+"px",e.setOption("viewportMargin",1/0)})}};__decorate([o.property()],s.prototype,"mode",void 0),__decorate([o.property({type:Array})],s.prototype,"addons",void 0),__decorate([o.property({type:Object})],s.prototype,"options",void 0),s=__decorate([o.customElement("typo3-editor")],s);return new class{static createPanelNode(e,t){const r=document.createElement("div");r.setAttribute("class","CodeMirror-panel CodeMirror-panel-"+e),r.setAttribute("id","panel-"+e);const o=document.createElement("span");return o.textContent=t,r.appendChild(o),r}constructor(){this.initialize()}initialize(){i.ready().then(()=>{this.observeEditorCandidates()})}observeEditorCandidates(){document.querySelectorAll("textarea.t3editor").forEach(e=>{if("typo3-editor"===e.parentElement.tagName.toLowerCase())return;const t=document.createElement("typo3-editor"),r=JSON.parse(e.getAttribute("data-codemirror-config"));t.setAttribute("mode",r.mode),t.setAttribute("addons",r.addons),t.setAttribute("options",r.options),this.wrap(e,t)})}wrap(e,t){e.parentElement.insertBefore(t,e),t.appendChild(e)}}}));