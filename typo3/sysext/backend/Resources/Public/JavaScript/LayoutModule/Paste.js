/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["jquery","../AjaxDataHandler","../Modal","../Severity"],(function(t,e,a,s){"use strict";class n{constructor(){this.elementIdentifier=".t3js-page-ce",t(()=>{t(".t3js-page-columns").length&&this.activatePasteIcons()})}static determineColumn(t){const e=t.closest("[data-colpos]");return e.length&&"undefined"!==e.data("colpos")?e.data("colpos"):0}activatePasteIcons(){const e=this;t(".t3-page-ce-wrapper-new-ce").each((a,s)=>{if(t(s).find(".t3js-toggle-new-content-element-wizard").length&&(t(".t3js-page-lang-column .t3-page-ce > .t3-page-ce").removeClass("t3js-page-ce"),top.pasteAfterLinkTemplate&&top.pasteIntoLinkTemplate)){t(s).parent().data("page")?t(s).append(top.pasteIntoLinkTemplate):t(s).append(top.pasteAfterLinkTemplate),t(s).find(".t3js-paste").on("click",a=>{a.preventDefault(),e.activatePasteModal(t(a.currentTarget))})}})}activatePasteModal(e){const n=this,o=t(e),l=o.data("url")||null,i=(TYPO3.lang["paste.modal.title.paste"]||"Paste record")+': "'+o.data("title")+'"',r=TYPO3.lang["paste.modal.paste"]||"Do you want to paste the record to this position?",d=void 0!==top.TYPO3.Severity[o.data("severity")]?top.TYPO3.Severity[o.data("severity")]:top.TYPO3.Severity.info;let c=[];if(c=[{text:TYPO3.lang["paste.modal.button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",trigger:()=>{a.currentModal.trigger("modal-dismiss")}},{text:TYPO3.lang["paste.modal.button.paste"]||"Paste",btnClass:"btn-"+s.getCssClass(d),trigger:()=>{a.currentModal.trigger("modal-dismiss"),n.execute(o)}}],null!==l){const e=l.contains("?")?"&":"?",s=t.param({data:o.data()});a.loadUrl(i,d,c,l+e+s)}else a.show(i,r,d,c)}execute(t){const a=n.determineColumn(t),s=t.closest(this.elementIdentifier),o=s.data("uid");let l;l=void 0===o?parseInt(s.data("page"),10):0-parseInt(o,10);const i={CB:{paste:"tt_content|"+l,update:{colPos:a,sys_language_uid:parseInt(t.closest("[data-language-uid]").data("language-uid"),10)}}};e.process(i).then(t=>{t.hasErrors||window.location.reload()})}}return new n}));