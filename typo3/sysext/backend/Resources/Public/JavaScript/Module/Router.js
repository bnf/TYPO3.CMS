/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__decorate=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};define(["require","exports","lit-element"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModuleRouter=void 0;let n=class extends o.LitElement{constructor(){super(),this.module="",this.endpoint="",this.decorate=!1,this.element=null,this.popstateHandler=e=>{this._handlePopstate(e)},this.addEventListener("typo3-module-load",e=>{const t=e.target.tagName.toLowerCase();if(console.log('catched load from "'+t+'" in module-router',e),"typo3-iframe-module"!==t){const o={tagName:t,detail:e.detail},n=this.getAttribute("state-tracker")+"?state="+encodeURIComponent(JSON.stringify(o));console.log('setting "'+n+'" on iframe-module in load');const i=this.querySelector("typo3-iframe-module");return i&&i.getAttribute("endpoint")!==n&&i.setAttribute("endpoint",n),void e.stopImmediatePropagation()}if("typo3-iframe-module"===t){const t=e.detail.url,o=this.shadowRoot.querySelector("slot");if(t.includes(this.getAttribute("state-tracker")+"?state=")){const n=t.split("?state="),i=JSON.parse(decodeURIComponent(n[1]||"{}"));if(o&&o.getAttribute("name")!==i.tagName){o.setAttribute("name",i.tagName);const e=this.querySelector(i.tagName);e&&e.setAttribute("endpoint",i.detail.url)}e.detail.module=i.detail.module,e.detail.url=i.detail.url}else o&&"typo3-iframe-module"!==o.getAttribute("name")&&o.setAttribute("name","typo3-iframe-module")}e.detail.decorate=!0,this.decorate&&(e.detail.decorate=!0,this.decorate=!1)}),this.addEventListener("typo3-module-loaded",e=>{console.log("sending load event from module-router",e),this.dispatchEvent(new CustomEvent("load"))})}static get styles(){return o.css`
      :host {
        display: block;
        min-height: 100%;
      }
    `}attributeChangedCallback(e,t,o){console.log("attribute change: ",e,o,t),super.attributeChangedCallback(e,t,o),"module"!==e&&"endpoint"!==e||this.requestUpdate()}connectedCallback(){super.connectedCallback(),window.addEventListener("popstate",this.popstateHandler)}disconnectedCallback(){window.addEventListener("popstate",this.popstateHandler),super.disconnectedCallback()}render(){const t=this.getRecordFromName(this.module),n=t.element||"typo3-iframe-module";let i=this.querySelector(n);if(null===i){const o=t.elementModule||"TYPO3/CMS/Backend/Module/Iframe";new Promise((t,n)=>{e([o],t,n)}).then(__importStar).catch(e=>console.error("Error importing "+o+" for <"+n+">")),i=document.createElement(n),i.setAttribute("slot",n),this.appendChild(i)}i.setAttribute("endpoint",this.endpoint),i.setAttribute("active","");for(let e=i.previousElementSibling;null!==e;e=e.previousElementSibling)e.removeAttribute("active");for(let e=i.nextElementSibling;null!==e;e=e.nextElementSibling)e.removeAttribute("active");return o.html`<slot name="${n}"></slot>`}_handlePopstate(e){console.log("location: "+document.location+", state: "+JSON.stringify(e.state)),null!==e.state&&(e.state.module?(this.setAttribute("module",e.state.module),this.decorate=!0):this.removeAttribute("module"),e.state.url?(this.setAttribute("endpoint",e.state.url),this.decorate=!0):this.removeAttribute("endpoint"))}getRecordFromName(e){const t=document.getElementById(e);return t?{name:e,navigationComponentId:t.dataset.navigationcomponentid,navigationFrameScript:t.dataset.navigationframescript,navigationFrameScriptParam:t.dataset.navigationframescriptparameters,link:t.dataset.link,element:t.dataset.element,elementModule:t.dataset.elementModule}:{name:"",navigationComponentId:"",navigationFrameScript:"",navigationFrameScriptParam:"",link:"",element:"",elementModule:""}}};__decorate([o.property({type:String,reflect:!0})],n.prototype,"module",void 0),__decorate([o.property({type:String,reflect:!0})],n.prototype,"endpoint",void 0),n=__decorate([o.customElement("typo3-backend-module-router")],n),t.ModuleRouter=n}));